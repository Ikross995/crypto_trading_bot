# Руководство по внесению изменений в код

Этот документ объясняет, как устроен проект и каким образом безопасно
вносить правки, чтобы тесты и существующая функциональность оставались
рабочими. Следуйте приведённым ниже шагам, если необходимо исправить
ошибку или добавить новую возможность.

## 1. Понимание структуры проекта

Основные модули разделены на несколько папок:

- `core/` — конфигурация, типы и вспомогательные утилиты, которые
  используют остальные компоненты. Например, `core/config.py`
  отвечает за загрузку настроек, а `core/types.py` определяет структуру
  рыночных данных и торговых сигналов.【F:core/config.py†L1-L162】【F:core/types.py†L1-L181】
- `exchange/` — клиенты, позиции и работа с API биржи. Здесь находятся
  классы для взаимодействия с реальным или имитированным источником
  котировок, например `exchange/client.py` и `exchange/positions.py`.
  Эти компоненты используют константы и типы из `core/`.【F:exchange/client.py†L1-L310】【F:exchange/positions.py†L1-L227】
- `strategy/` — генерация торговых сигналов, риск-менеджмент и другие
  алгоритмические блоки. В частности, `strategy/signals.py` создает
  торговые решения на основе рынка и конфигурации.【F:strategy/signals.py†L1-L281】
- `data/` — вспомогательные данные и симуляторы. Например,
  `data/samples/sample_loader.py` загружает встроенные CSV-файлы с
  тестовыми свечами, а `data/simulator.py` обеспечивает генерацию
  синтетических цен для отладки.【F:data/samples/sample_loader.py†L1-L169】【F:data/simulator.py†L1-L356】
- `runner/` — точки входа для различных режимов работы (бумажная
  торговля, бэктест, лайв). Скрипты вроде `runner/paper.py` собирают
  воедино конфигурацию, стратегию и клиентов биржи.【F:runner/paper.py†L1-L214】

Папка `tests/` содержит автоматические проверки, которые помогают
убедиться, что изменения не ломают существующий функционал. Тесты
охватывают загрузку данных (`tests/test_sample_data.py`), утилиты ядра
(`tests/test_core_utils.py`), демо-торговлю и другие сценарии.【F:tests/test_sample_data.py†L1-L182】【F:tests/test_core_utils.py†L1-L150】【F:tests/test_demo_traiding.py†L1-L132】

## 2. Процесс внесения правок

1. **Создайте новую ветку** от текущего состояния репозитория, чтобы
   изолировать изменения.
2. **Внесите правки в соответствующие файлы**. Опирайтесь на структуру
   проекта из предыдущего раздела, чтобы быстро найти нужный модуль.
3. **Запустите тесты** командой `pytest` из корня проекта. Это позволит
   поймать регрессии до того, как изменения отправятся в основной
   репозиторий.【3efe54†L1-L4】
4. При необходимости используйте встроенные CSV-данные или симулятор,
   чтобы локально воспроизвести проблему. Например, функция
   `load_sample_data` поможет получить исторические свечи для тестов
   или интерактивной отладки.【F:data/samples/sample_loader.py†L79-L113】
5. Убедитесь, что логирование и конфигурации обновлены, если менялись
   параметры запуска бота.

## 3. Отладка типовых проблем

- **Некорректные сигналы или позиции.** Проверьте взаимодействие между
  `strategy/signals.py` и `exchange/positions.py`, чтобы убедиться, что
  стратегия генерирует ожидаемые типы сигналов, а менеджер позиций
  правильно их обрабатывает.
- **Ошибки при загрузке данных.** Убедитесь, что CSV-файлы с выборками
  расположены в `data/samples/` и содержат обязательные столбцы
  (`open`, `high`, `low`, `close`, `volume`). Функция `validate_sample_data`
  выполняет автоматическую проверку целостности файлов.【F:data/samples/sample_loader.py†L115-L167】
- **Проблемы с подключением к бирже.** Посмотрите на реализацию клиента
  в `exchange/client.py`. В проект встроен механизм отката на
  симулятор, если реальные ключи недоступны. Логи подскажут, какая ветка
  кода использовалась при инициализации клиента.【F:exchange/client.py†L42-L164】

## 4. Проверка изменений перед коммитом

Перед коммитом убедитесь, что все тесты проходят и нет статических
ошибок. Рекомендуется также выполнить `python cli.py --help`, чтобы
проверить, что интерфейс командной строки успешно импортирует все
зависимости. После успешного запуска тестов зафиксируйте изменения и
создайте Pull Request с описанием сути правок.

Следуя этому процессу, вы сможете вносить правки последовательно,
понимая, какие компоненты затрагиваются и как убедиться, что система
остаётся работоспособной.
